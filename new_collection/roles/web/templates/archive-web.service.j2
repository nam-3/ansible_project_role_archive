[Unit]
Description=Archive CMP Platform Web API
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/cmp_app
{% if groups['gateway'] is defined and groups['gateway'] | length > 0 %}
Environment="REDIS_HOST={{ hostvars[groups['gateway'][0]]['ansible_host'] }}"
{% else %}
Environment="REDIS_HOST={{ redis_host | default('127.0.0.1') }}"
{% endif %}
# SECRET_KEY / ENCRYPT_KEY: /etc/environment 또는 /etc/default/archive-web 에서 로드
EnvironmentFile=-/etc/environment
EnvironmentFile=-/etc/default/archive-web
ExecStart=/usr/local/bin/uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
