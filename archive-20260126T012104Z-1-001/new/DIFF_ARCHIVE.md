# 🆚 버전 비교 분석: `new` vs `archive/cmp`

현재 개발 중인 `new/main.py`와 보관된 `new/archive/cmp/main.py`의 주요 차이점을 분석한 문서입니다. `new` 버전은 `archive` 버전을 기반으로 **보안, 사용자 관리, 멀티 테넌시 기능**이 대폭 강화된 것으로 파악됩니다.

---

## 1. 🔑 인증 및 사용자 관리 (Authentication & User Management)

가장 큰 차이점은 **계정 관리 시스템의 유무**입니다.

| 기능 | `new/main.py` (Current) | `archive/cmp/main.py` (Legacy) |
| :--- | :--- | :--- |
| **회원가입** | ✅ **지원** (`/api/signup`) | ❌ 지원 안 함 |
| **로그인 방식** | **DB 기반** (`UserAccount` 테이블 조회 + 비밀번호 암호화 검증) | **단순 비교** (관리자 비밀번호 또는 환경변수와 단순 문자열 비교) |
| **계정 승인** | ✅ **관리자 승인제** (`pending` -> `active`) | ❌ 없음 (모든 접속자가 익명 또는 공용 관리자) |
| **DB 모델** | `UserAccount`, `UserQuota` 테이블 **존재** | 해당 테이블 모델 정의 없음 |
| **비밀번호 저장** | `Fernet` 양방향 암호화 저장 | 평문 비교 또는 설정 파일 의존 |

> **분석**: `new` 버전은 다수의 사용자가 가입하고, 관리자가 이를 승인하며, 사용자별로 자원을 격리하는 **멀티 유저(Multi-user) 시스템**으로 진화했습니다.

---

## 2. 🌍 환경 설정 및 구성 (Configuration)

설정 값을 관리하는 방식에서 차이가 있습니다. `archive` 버전이 오히려 배포 환경(Env)에 더 유연하게 작성된 측면이 있습니다.

| 항목 | `new/main.py` | `archive/cmp/main.py` |
| :--- | :--- | :--- |
| **DB 연결** | ⚠️ **하드코딩** (`192.168.40.15`) | ✅ **환경변수** (`os.getenv('DB_HOST')`) |
| **Redis 연결** | ⚠️ **하드코딩** (`172.16.6.77`) | ✅ **환경변수** (`os.getenv('REDIS_HOST')`) |
| **Prometheus** | ⚠️ **하드코딩** (`192.168.40.127`) | ✅ **환경변수** (`os.getenv('MONITORING_HOST')`) |
| **Secret Key** | 일부 하드코딩 및 환경변수 혼용 | 환경변수 우선 사용 로직 |

> **주의**: `new` 버전 개발 과정에서 테스트 편의를 위해 IP 주소들이 코드에 직접 입력(Hard-coding)된 것으로 보입니다. 운영 배포 시에는 `archive` 버전처럼 **환경 변수화(Environment Variables)** 하는 리팩토링이 권장됩니다.

---

## 3. 🛡️ 보안 및 권한 제어 (Security & RBAC)

| 기능 | `new/main.py` | `archive/cmp/main.py` |
| :--- | :--- | :--- |
| **리소스 격리** | **본인 소유 자원만 조회** (`owner` 필드 필터링) | 구분 없음 (모든 사용자가 모든 자원 조회 가능) |
| **관리자 기능** | 별도 API 분리 (`/api/admin/*`) 및 권한 체크 | API 구분 미비 |
| **토큰 검증** | JWT 페이로드의 `role`, `sub` 활용 | 단순 토큰 디코딩 |

---

## 4. 📝 기타 기능적 차이

*   **API 엔드포인트**: `new` 버전에는 사용자 승인, 거절, 목록 조회 등 관리자 전용 API가 다수 추가되었습니다.
*   **자원 회수 로직**: 두 버전 모두 프로젝트 삭제 시 자원을 반납하는 로직은 유사하나, `new` 버전은 `WorkloadPool`의 상태 관리가 더 세분화(`provisioning` vs `assigned`) 되어 있습니다.

---

## 5. 결론 및 제언

*   **`new` 버전의 발전**: 단순 프로토타입이었던 `archive` 버전에 비해, 실제 서비스를 위한 **사용자 인증, 데이터베이스 모델링, 권한 관리** 기능이 완성되었습니다.
*   **개선 필요 사항**: `archive` 버전의 장점인 **환경 변수 설정(Config via Environment)** 패턴을 `new` 버전에 다시 적용하면, IP 변경 시 코드를 수정하지 않아도 되므로 유지보수성이 향상될 것입니다.
