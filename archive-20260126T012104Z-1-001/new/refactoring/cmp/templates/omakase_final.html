<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solution Omakase | H-CMP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; }
        .hidden { display: none; }
        .flex { display: flex; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        .blue-gradient { background: linear-gradient(135deg, #1d4ed8 0%, #2563eb 100%); }
        .card-active { border: 2px solid #2563eb !important; background-color: #eff6ff !important; transform: scale(1.02); }
        .node-enter { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
        .console-font { font-family: 'Menlo', 'Monaco', 'Courier New', monospace; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .shake { animation: shake 0.3s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
        
        /* íŒ¨í‚¤ì§€ ê·¸ë¦¬ë“œ ì„ íƒ ìŠ¤íƒ€ì¼ */
        .pkg-checkbox:checked + div { background-color: #eff6ff; border-color: #2563eb; color: #1e40af; }
        .pkg-checkbox:checked + div .icon-check { display: block; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <div id="landing-page" class="min-h-screen flex flex-col bg-white overflow-y-auto">
        <nav class="px-8 py-5 border-b flex justify-between items-center sticky top-0 bg-white/90 z-50">
            <div class="flex items-center gap-2 font-black text-2xl text-blue-700 cursor-pointer" onclick="location.reload()">
                <i data-lucide="chef-hat"></i> Solution Omakase
            </div>
            <div class="flex gap-6 items-center">
                <button onclick="openLoginModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full text-sm font-bold transition shadow-lg">Console ë¡œê·¸ì¸</button>
            </div>
        </nav>
        <main class="flex-1 flex flex-col items-center justify-center text-center px-4 py-20">
            <span class="bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full text-xs font-black mb-6 border border-blue-100 uppercase tracking-widest italic">DevOps Engineering Platform</span>
            <h1 class="text-5xl md:text-7xl font-extrabold text-slate-900 mb-8 leading-[1.1]">Just Order,<br><span class="text-blue-600 italic">We Serve Infrastructure.</span></h1>
            <p class="text-slate-500 text-lg md:text-xl max-w-2xl mb-12 leading-relaxed break-keep">ë³µì¡í•œ ì„¤ì • ì—†ì´ <strong>3-Tier ì•„í‚¤í…ì²˜ í…œí”Œë¦¿</strong>ì„ ì„ íƒí•˜ì„¸ìš”.<br>H-CMPê°€ ìµœì ì˜ í•˜ì´ë¸Œë¦¬ë“œ í´ë¼ìš°ë“œ ì¸í”„ë¼ë¥¼ ìë™ìœ¼ë¡œ ì„¤ê³„í•©ë‹ˆë‹¤.</p>
            <button onclick="openLoginModal()" class="blue-gradient text-white text-xl font-bold px-12 py-5 rounded-2xl shadow-xl hover:shadow-blue-200 transition-all flex items-center gap-2 group active:scale-95">í”„ë¡œì íŠ¸ ìƒì„±í•˜ê¸° <i data-lucide="chevron-right" class="group-hover:translate-x-1 transition"></i></button>
        </main>
    </div>

    <div id="login-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center px-4 bg-slate-900/60 backdrop-blur-sm fade-in">
        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden p-8 text-center relative">
            <button onclick="closeLoginModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6"><i data-lucide="lock" class="w-8 h-8"></i></div>
            <h2 class="text-2xl font-black text-slate-900 mb-2">Admin Login</h2>
            <p class="text-sm text-slate-500 mb-8">ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ì ‘ì†í•´ ì£¼ì„¸ìš”.</p>
            <div class="space-y-4 text-left">
                <div><label class="block text-xs font-bold text-slate-500 mb-1">ID</label><input type="text" id="login_id" class="w-full border border-slate-300 rounded-lg px-4 py-3 font-bold focus:border-blue-500 outline-none" placeholder="admin"></div>
                <div><label class="block text-xs font-bold text-slate-500 mb-1">PASSWORD</label><input type="password" id="login_pw" onkeydown="if(event.key==='Enter') tryLogin()" class="w-full border border-slate-300 rounded-lg px-4 py-3 font-bold focus:border-blue-500 outline-none" placeholder="â€¢â€¢â€¢â€¢"></div>
            </div>
            <button onclick="tryLogin()" id="btn-login" class="w-full blue-gradient text-white py-4 rounded-xl font-bold mt-8 shadow-lg hover:bg-blue-700 transition">ë¡œê·¸ì¸ í•˜ê¸°</button>
        </div>
    </div>

    <div id="settings-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center px-4 bg-slate-900/60 backdrop-blur-sm fade-in">
        <div class="bg-white w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden p-8 relative max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-black text-slate-900 flex items-center gap-2"><i data-lucide="settings" class="text-slate-500"></i> Admin Settings & Analytics</h2>
                <button onclick="closeSettingsModal()" class="text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            </div>
            <div class="space-y-8">
                <div class="bg-slate-900 text-white p-5 rounded-xl shadow-lg">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 flex items-center gap-2"><i data-lucide="bar-chart-3" class="w-4 h-4"></i> System Analytics</h3>
                    <div class="grid grid-cols-3 gap-6 text-center divide-x divide-slate-700">
                        <div><p class="text-slate-400 text-xs mb-1">Total Projects</p><p class="text-2xl font-black text-emerald-400" id="stat_total">0</p></div>
                        <div>
                            <p class="text-slate-400 text-xs mb-1">vCPU Usage</p>
                            <div class="flex justify-center items-end gap-1"><p class="text-2xl font-black text-blue-400" id="stat_vcpu">0</p><span class="text-xs text-slate-500 mb-1" id="stat_vcpu_max">/ 100</span></div>
                            <div class="w-full bg-slate-700 h-1.5 rounded-full mt-2 overflow-hidden"><div id="bar_vcpu" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div></div>
                        </div>
                        <div>
                            <p class="text-slate-400 text-xs mb-1">Memory Usage</p>
                            <div class="flex justify-center items-end gap-1"><p class="text-2xl font-black text-purple-400" id="stat_mem">0</p><span class="text-xs text-slate-500 mb-1" id="stat_mem_max">/ 256</span></div>
                            <div class="w-full bg-slate-700 h-1.5 rounded-full mt-2 overflow-hidden"><div id="bar_mem" class="h-full bg-purple-500 transition-all duration-500" style="width: 0%"></div></div>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <label class="flex justify-between items-center cursor-pointer">
                            <div><span class="block text-sm font-bold text-slate-800">Maintenance Mode</span><span class="text-xs text-slate-500">Block new requests</span></div>
                            <div class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="set_maint_mode" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div></div>
                        </label>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <label class="block text-xs font-bold text-slate-500 mb-2">System Announcement (Banner)</label>
                        <input type="text" id="set_notice" class="w-full bg-white border border-slate-300 rounded-lg px-3 py-1.5 text-xs focus:border-blue-500 outline-none" placeholder="e.g. Scheduled Maintenance 22:00">
                    </div>
                </div>
                <div>
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-3">Resource Quotas</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-slate-500 mb-1">Max vCPU</label><input type="number" id="set_max_vcpu" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm font-mono focus:border-blue-500 outline-none"></div>
                        <div><label class="block text-xs font-bold text-slate-500 mb-1">Max Mem (GB)</label><input type="number" id="set_max_mem" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm font-mono focus:border-blue-500 outline-none"></div>
                    </div>
                </div>
                <div>
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-3">Target Infrastructure</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-xs font-bold text-slate-500 mb-1">vCenter IP</label><input type="text" id="set_vcenter" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm font-mono focus:border-blue-500 outline-none"></div>
                        <div><label class="block text-xs font-bold text-slate-500 mb-1">ESXi IP</label><input type="text" id="set_esxi" class="w-full border border-slate-300 rounded-lg px-3 py-2 text-sm font-mono focus:border-blue-500 outline-none"></div>
                    </div>
                </div>
                <div class="pt-4 border-t border-slate-100 flex items-center justify-between">
                    <div>
                        <h3 class="text-xs font-black text-red-500 uppercase tracking-widest mb-1">Danger Zone</h3>
                        <p class="text-[10px] text-slate-400">Delete all project history data permanently.</p>
                    </div>
                    <button onclick="factoryReset()" class="border border-red-200 text-red-600 hover:bg-red-50 px-4 py-2 rounded-lg font-bold transition flex items-center gap-2 text-xs"><i data-lucide="trash-2" class="w-3 h-3"></i> Factory Reset</button>
                </div>
                <div class="pt-2">
                    <label class="block text-xs font-bold text-slate-400 mb-1">Admin Password</label>
                    <input type="password" id="set_admin_pw" class="w-full border border-slate-300 bg-slate-50 rounded-lg px-3 py-2 text-sm focus:border-slate-500 outline-none" placeholder="Confirm password">
                    <button onclick="saveSettings()" id="btn-save-settings" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-700 transition mt-3 flex justify-center items-center gap-2"><i data-lucide="save"></i> Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <div id="dashboard-page" class="hidden min-h-screen flex flex-col fade-in relative">
        <div id="notice-banner" class="hidden bg-amber-100 border-b border-amber-200 text-amber-800 px-4 py-2 text-center text-xs font-bold flex items-center justify-center gap-2">
            <i data-lucide="megaphone" class="w-4 h-4"></i> <span id="notice-text"></span>
        </div>

        <header class="bg-blue-800 text-white px-8 py-4 flex justify-between items-center shadow-md">
            <div class="flex items-center gap-4">
                <button onclick="location.reload()" class="hover:bg-blue-700 p-2 rounded-lg transition"><i data-lucide="layout-grid"></i></button>
                <h1 class="text-lg font-black tracking-tight">SOL-MAKASE CONSOLE</h1>
            </div>
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-3 bg-blue-900/50 border border-blue-500/30 px-4 py-2 rounded-lg shadow-inner">
                    <div class="flex items-center gap-2 text-blue-200">
                        <i data-lucide="clock" class="w-4 h-4 animate-pulse"></i>
                        <span id="session-timer" class="font-mono text-white text-sm font-bold tracking-wider">60:00</span>
                        <button onclick="extendSession()" class="text-blue-300 hover:text-white transition p-1 hover:bg-blue-600/30 rounded" title="ë¡œê·¸ì¸ ì—°ì¥ (1ì‹œê°„)"><i data-lucide="rotate-cw" class="w-3.5 h-3.5"></i></button>
                    </div>
                    <div class="h-4 w-px bg-blue-500/30"></div>
                    <button onclick="logout()" class="flex items-center gap-1.5 text-xs font-bold text-red-300 hover:text-white transition group"><i data-lucide="log-out" class="w-3 h-3 group-hover:translate-x-0.5 transition"></i> LOGOUT</button>
                </div>
                <div class="flex items-center gap-3">
                    <div class="text-right hidden md:block"><p class="text-[10px] text-blue-300 font-bold uppercase tracking-widest">Administrator</p><p class="text-xs font-bold">Session Active</p></div>
                    <div class="w-9 h-9 rounded-full bg-blue-600 border-2 border-blue-400 flex items-center justify-center shadow-lg font-black text-sm">A</div>
                </div>
            </div>
        </header>

        <div class="flex-1 flex flex-col lg:flex-row overflow-hidden">
            <nav class="w-full lg:w-20 bg-white border-r flex lg:flex-col items-center py-6 gap-8 border-slate-200">
                <i onclick="location.reload()" data-lucide="home" class="w-6 h-6 text-blue-600 cursor-pointer hover:scale-110 transition" title="í™ˆìœ¼ë¡œ"></i>
                <i onclick="location.href='/monitoring'" data-lucide="activity" class="w-6 h-6 text-slate-400 hover:text-blue-600 cursor-pointer hover:scale-110 transition" title="ìì› ëª¨ë‹ˆí„°ë§"></i>
                <i onclick="location.href='/history'" data-lucide="server" class="w-6 h-6 text-slate-400 hover:text-blue-600 cursor-pointer hover:scale-110 transition" title="ì£¼ë¬¸ ë‚´ì—­"></i>
                <i onclick="openSettingsModal()" data-lucide="settings" class="w-6 h-6 text-slate-400 hover:text-blue-600 cursor-pointer hover:scale-110 transition mt-auto" title="ì„¤ì • (ê´€ë¦¬ì ì „ìš©)"></i>
            </nav>

            <main class="flex-1 p-8 overflow-y-auto bg-slate-50">
                <div class="max-w-5xl mx-auto space-y-8 pb-20">
                    <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6">Step 01. Project Metadata</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-2">Service Name <span class="text-red-500">*</span></label>
                                <input type="text" id="svc_name" oninput="validateName(); updateArchitecture();" placeholder="e.g. core-banking-web" class="w-full border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-blue-600 transition font-bold text-blue-900">
                                <p id="name_err" class="hidden text-[11px] text-red-500 font-bold mt-2 flex items-center gap-1"><i data-lucide="alert-circle" class="w-3 h-3"></i> ì˜ë¬¸ ì†Œë¬¸ì, ìˆ«ì, í•˜ì´í”ˆ(-)ë§Œ ê°€ëŠ¥</p>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 mb-2">Environment</label>
                                <select id="env_type" onchange="updateArchitecture()" class="w-full border border-slate-200 rounded-xl px-4 py-3 outline-none font-bold text-slate-700 bg-white">
                                    <option value="dev">Development (Dev)</option>
                                    <option value="stg">Staging (Stg)</option>
                                    <option value="prd">Production (Prd)</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Step 02. Quick Start Templates</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div id="tpl-single" onclick="applyTemplate('single')" class="bg-white p-5 rounded-2xl border border-slate-200 cursor-pointer hover:border-blue-300 transition group shadow-sm flex flex-col gap-2"><div class="flex items-center gap-2 mb-2"><div class="bg-slate-100 p-2 rounded-lg group-hover:bg-blue-100 transition"><i data-lucide="box" class="w-5 h-5 text-slate-600 group-hover:text-blue-600"></i></div><span class="font-bold text-slate-700">Single Tier</span></div><p class="text-xs text-slate-500 leading-relaxed">ê°œë°œ ë° í…ŒìŠ¤íŠ¸ìš© ë‹¨ì¼ ì„œë²„ í™˜ê²½ì…ë‹ˆë‹¤.</p></div>
                            <div id="tpl-3tier" onclick="applyTemplate('3tier')" class="bg-white p-5 rounded-2xl border border-slate-200 cursor-pointer hover:border-blue-300 transition group shadow-sm flex flex-col gap-2 relative overflow-hidden card-active"><div class="absolute top-0 right-0 bg-blue-600 text-white text-[10px] font-bold px-2 py-1 rounded-bl-lg">RECOMMENDED</div><div class="flex items-center gap-2 mb-2"><div class="bg-slate-100 p-2 rounded-lg group-hover:bg-blue-100 transition"><i data-lucide="layers" class="w-5 h-5 text-slate-600 group-hover:text-blue-600"></i></div><span class="font-bold text-slate-700">Standard 3-Tier</span></div><p class="text-xs text-slate-500 leading-relaxed">Web-App-DBê°€ ë¶„ë¦¬ëœ í‘œì¤€ ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤.</p></div>
                            <div id="tpl-ha" onclick="applyTemplate('ha')" class="bg-white p-5 rounded-2xl border border-slate-200 cursor-pointer hover:border-blue-300 transition group shadow-sm flex flex-col gap-2"><div class="flex items-center gap-2 mb-2"><div class="bg-slate-100 p-2 rounded-lg group-hover:bg-blue-100 transition"><i data-lucide="zap" class="w-5 h-5 text-slate-600 group-hover:text-blue-600"></i></div><span class="font-bold text-slate-700">High Performance</span></div><p class="text-xs text-slate-500 leading-relaxed">ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì²˜ë¦¬ë¥¼ ìœ„í•œ í™•ì¥ êµ¬ì„±ì…ë‹ˆë‹¤.</p></div>
                        </div>
                    </section>

                    <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-6">Step 03. Infrastructure & Software Stack</h2>
                        <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
                            <div class="md:col-span-5 space-y-6">
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2 text-sm font-bold text-slate-700"><i data-lucide="users" class="w-4 h-4 text-blue-600"></i> Traffic / Scale Rule</label>
                                    <select id="traffic_level" onchange="resetTemplateSelection(); updateArchitecture()" class="w-full p-3 bg-slate-50 border rounded-xl font-medium text-sm outline-none focus:ring-2 focus:ring-blue-200 transition">
                                        <option value="low">Low (Single Node)</option>
                                        <option value="mid" selected>Medium (Multi Node)</option>
                                        <option value="high">High (Scale-out)</option>
                                    </select>
                                </div>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2 text-sm font-bold text-slate-700"><i data-lucide="activity" class="w-4 h-4 text-emerald-600"></i> Availability (HA)</label>
                                    <select id="ha_level" onchange="resetTemplateSelection(); updateArchitecture()" class="w-full p-3 bg-slate-50 border rounded-xl font-medium text-sm outline-none focus:ring-2 focus:ring-emerald-200 transition">
                                        <option value="single">Single Node</option>
                                        <option value="ha" selected>HA (Active-Standby)</option>
                                    </select>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Target Network</span>
                                    <div id="dynamic-network" class="mt-2 space-y-1"></div>
                                </div>
                            </div>

                            <div class="md:col-span-7">
                                <div class="flex justify-between items-center mb-4">
                                    <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Installable Packages (Select)</span>
                                    <span class="text-[10px] text-blue-600 font-bold bg-blue-50 px-2 py-1 rounded-full cursor-pointer hover:bg-blue-100 transition" onclick="resetSoftware()">Reset All</span>
                                </div>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3" id="package-grid"></div>
                            </div>
                        </div>
                    </section>

                    <section class="bg-slate-900 text-white p-6 rounded-2xl shadow-xl border border-slate-700 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-20"><i data-lucide="server" class="w-32 h-32"></i></div>
                        <h2 class="text-xs font-black text-blue-400 uppercase tracking-widest mb-6 relative z-10">Step 04. Generated Architecture Preview</h2>
                        <div class="relative z-10 flex flex-col items-center gap-8 py-4">
                            <div id="layer-lb" class="hidden flex flex-col items-center node-enter w-full"><span class="text-[10px] text-slate-400 mb-1">Tier 1. Presentation</span><div class="bg-emerald-600 p-3 rounded-lg shadow-lg border border-emerald-400 flex items-center gap-2"><i data-lucide="network" class="w-5 h-5"></i> <span class="text-sm font-bold">L4 HA Proxy</span></div><div class="h-8 w-0.5 bg-slate-600 my-1"></div></div>
                            <div class="flex flex-col items-center w-full"><span class="text-[10px] text-slate-400 mb-1">Tier 2. Application (Web/WAS)</span><div class="flex gap-4 justify-center" id="layer-web"></div></div>
                            <div class="h-8 w-0.5 bg-slate-600"></div>
                            <div class="flex flex-col items-center w-full"><span class="text-[10px] text-slate-400 mb-1">Tier 3. Data</span><div class="flex gap-4 justify-center" id="layer-db"></div></div>
                            <div id="layer-dr" class="hidden mt-4 pt-4 border-t border-dashed border-slate-600 w-full text-center node-enter"><span class="text-[10px] text-rose-400 uppercase font-bold tracking-widest mb-2 block">Disaster Recovery Site (Public Cloud)</span><div class="inline-flex bg-rose-900/50 p-3 rounded-lg border border-rose-700 items-center gap-2 text-rose-200"><i data-lucide="cloud-lightning" class="w-4 h-4"></i> <span class="text-xs">Standby Resources Ready</span></div></div>
                        </div>
                    </section>
                </div>
            </main>

            <aside class="w-full lg:w-96 bg-white border-l border-slate-200 flex flex-col sticky top-0 h-screen shadow-xl z-20">
                <div id="summary-panel" class="flex flex-col h-full p-6">
                    <h3 class="text-lg font-black text-slate-900 mb-6 flex items-center gap-2 italic"><i data-lucide="shopping-cart" class="text-blue-600"></i> Configuration Summary</h3>
                    <div class="flex-1 space-y-6 overflow-y-auto custom-scrollbar">
                        <div>
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Selected Packages</p>
                            <div id="selected-pkg-list" class="flex flex-wrap gap-2 mb-4"><span class="text-xs text-slate-400">None</span></div>
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Resource Manifest</p>
                            <div class="border border-slate-200 rounded-lg overflow-hidden text-xs"><table class="w-full text-left"><thead class="bg-slate-50 text-slate-500 font-bold"><tr><th class="p-2 border-b">Instance</th><th class="p-2 border-b">Ansible Role</th></tr></thead><tbody id="manifest-body" class="divide-y divide-slate-100"></tbody></table></div>
                        </div>
                        <div class="space-y-3 text-sm border-t pt-4">
                            <div class="flex justify-between items-center text-slate-500"><span>Architecture</span><span id="sum_type" class="font-bold text-slate-900">Standard 3-Tier</span></div>
                            <div class="flex justify-between items-center text-slate-500"><span>Total vCPU</span><span id="sum_vcpu" class="font-bold text-blue-600">4 Core</span></div>
                            <div class="flex justify-between items-center text-slate-500"><span>HA Strategy</span><span id="sum_ha" class="font-bold text-emerald-600">Active-Standby</span></div>
                        </div>
                    </div>
                    <div class="pt-6 mt-auto"><button onclick="startProvision()" id="btn-provision" class="w-full blue-gradient text-white py-4 rounded-xl font-black text-md shadow-lg shadow-blue-200 hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2"><i data-lucide="rocket"></i> START PROVISIONING</button></div>
                </div>
                <div id="console-panel" class="hidden flex-col h-full bg-slate-900 text-white p-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-8 opacity-10 pointer-events-none"><i data-lucide="terminal" class="w-40 h-40"></i></div>
                    <h3 class="text-lg font-black text-white mb-6 flex items-center gap-2 relative z-10"><span class="w-2 h-2 bg-emerald-500 rounded-full blink"></span> Deploying...</h3>
                    <div class="flex-1 overflow-y-auto space-y-6 relative z-10 console-font text-xs">
                        <div id="step-1" class="flex gap-3 opacity-50">
                            <div class="flex flex-col items-center">
                                <div id="step-1-icon" class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px]">1</div>
                                <div class="w-0.5 h-full bg-slate-700 mt-2"></div>
                            </div>
                            <div class="pb-6">
                                <p class="font-bold text-slate-300">vCenter Authentication</p>
                                <p class="text-slate-500 mt-1">Establishing session...</p>
                            </div>
                        </div>
                        <div id="step-2" class="flex gap-3 opacity-50">
                            <div class="flex flex-col items-center">
                                <div id="step-2-icon" class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px]">2</div>
                                <div class="w-0.5 h-full bg-slate-700 mt-2"></div>
                            </div>
                            <div class="pb-6">
                                <p class="font-bold text-slate-300">VM Resource Allocation</p>
                                <p class="text-slate-500 mt-1">Booting VMs on ESXi...</p>
                            </div>
                        </div>
                        <div id="step-3" class="flex gap-3 opacity-50">
                            <div class="flex flex-col items-center">
                                <div id="step-3-icon" class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px]">3</div>
                                <div class="w-0.5 h-full bg-slate-700 mt-2"></div>
                            </div>
                            <div class="pb-6">
                                <p class="font-bold text-slate-300">Network Configuration</p>
                                <p class="text-slate-500 mt-1">Attaching vSwitch & IPs...</p>
                            </div>
                        </div>
                        <div id="step-4" class="flex gap-3 opacity-50">
                            <div class="flex flex-col items-center">
                                <div id="step-4-icon" class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px]">4</div>
                                <div class="w-0.5 h-full bg-slate-700 mt-2"></div>
                            </div>
                            <div class="pb-6">
                                <p class="font-bold text-slate-300">Ansible Playbook Execution</p>
                                <p id="step-4-log" class="text-slate-500 mt-1">Running role: ...</p>
                            </div>
                        </div>
                        <div id="step-5" class="flex gap-3 opacity-50">
                            <div class="flex flex-col items-center">
                                <div id="step-5-icon" class="w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px]">5</div>
                            </div>
                            <div>
                                <p class="font-bold text-slate-300">Software Stack Installation</p>
                                <p id="step-5-log" class="text-slate-500 mt-1">Configuring Packages...</p>
                            </div>
                        </div>
                    </div>
                    <div id="console-log-area" class="h-64 bg-slate-950 rounded-lg p-3 overflow-y-auto mt-4 border border-slate-800 font-mono text-[11px]">
                        <div class="text-slate-500 italic">Waiting for logs...</div>
                    </div>
                    <button onclick="location.reload()" id="btn-finish" class="hidden w-full bg-emerald-600 text-white py-3 rounded-xl font-bold mt-4 hover:bg-emerald-500">Go to Dashboard</button>
                </div>
            </aside>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let config = { traffic: 'mid', ha: 'ha', dr: 'basic', template: 'single', packages: [], network: '' };
        
        // [ì—…ë°ì´íŠ¸: Apache ì‚­ì œ -> 12ê°œ ì•„ì´í…œ (3x4 ê·¸ë¦¬ë“œ)]
        const availableSoftware = [
            { id: 'nginx', name: 'Nginx', cat: 'Web' },
            { id: 'haproxy', name: 'HAProxy', cat: 'L4/LB' },
            // Apache ì œê±°ë¨ (ê¸°íšì•ˆ ë°˜ì˜ + 12ê°œ ë¹„ìœ¨ ë§ì¶¤)
            
            { id: 'python', name: 'Python (Django)', cat: 'App' },
            { id: 'tomcat', name: 'Tomcat', cat: 'WAS' },
            { id: 'nodejs', name: 'Node.js', cat: 'App' },

            { id: 'postgres', name: 'PostgreSQL', cat: 'DB' },
            { id: 'mysql', name: 'MySQL', cat: 'DB' }, 
            { id: 'redis', name: 'Redis', cat: 'Cache' },

            { id: 'elasticsearch', name: 'Elasticsearch', cat: 'Log/Mon' },
            { id: 'kibana', name: 'Kibana', cat: 'Log/Mon' },
            { id: 'jenkins', name: 'Jenkins', cat: 'CI/CD' },
            
            { id: 'docker', name: 'Docker', cat: 'Cont' }
        ];

        const SESSION_DURATION = 60 * 60 * 1000;
        let timerInterval = null;

        window.onload = function() {
            renderPackageGrid();
            applyTemplate('3tier');
            checkSession(); 
            // [ì¤‘ìš”: ë³´ì•ˆ íŒ¨ì¹˜] ë¡œê·¸ì¸ ì „ì—ëŠ” 'ê³µê°œ(Public)' APIë§Œ í˜¸ì¶œí•˜ë„ë¡ ìˆ˜ì •
            fetchPublicSettings();
        };

        // --- Fetch Public Settings (Notice) ---
        // [ìˆ˜ì •ë¨] /api/admin/settings -> /api/public/settings í˜¸ì¶œë¡œ ë³€ê²½
        // ì´ìœ : ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ê´€ë¦¬ì ì„¤ì •ì„ í˜¸ì¶œí•˜ëŠ” ë³´ì•ˆ ì·¨ì•½ì  í•´ê²°
        async function fetchPublicSettings() {
            try {
                // (ì£¼ì˜) ë°±ì—”ë“œì— /api/public/settings ì—”ë“œí¬ì¸íŠ¸ê°€ ì—†ìœ¼ë©´ 404ê°€ ëœ° ìˆ˜ ìˆìœ¼ë‚˜, 
                // ë³´ì•ˆ ì„¤ê³„ìƒ ì´ë ‡ê²Œ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ë§ìŒ.
                const res = await fetch('/api/public/settings');
                if(res.ok) {
                    const data = await res.json();
                    if(data.system_notice) {
                        const banner = document.getElementById('notice-banner');
                        document.getElementById('notice-text').innerText = data.system_notice;
                        banner.classList.remove('hidden');
                    }
                }
            } catch(e) {
                // ë°±ì—”ë“œ ë¯¸êµ¬í˜„ ì‹œ ì¡°ìš©íˆ ë¬´ì‹œ
                console.log("ê³µê°œ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨ (ë°±ì—”ë“œ í™•ì¸ í•„ìš”)");
            }
        }

        // --- Session ---
        function checkSession() {
            const expiresAt = localStorage.getItem('omakase_expires_at');
            if (expiresAt) {
                const now = Date.now();
                if (now < expiresAt) { showDashboard(); startSessionTimer(expiresAt); } 
                else { logout(); }
            }
        }
        function startSessionTimer(expiresAt) {
            clearInterval(timerInterval);
            function update() {
                const now = Date.now(); const diff = expiresAt - now;
                if (diff <= 0) { clearInterval(timerInterval); logout(); return; }
                const minutes = Math.floor(diff / 60000); const seconds = Math.floor((diff % 60000) / 1000);
                document.getElementById('session-timer').innerText = `${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;
            }
            update(); timerInterval = setInterval(update, 1000);
        }
        function extendSession() {
            const newExpires = Date.now() + SESSION_DURATION;
            localStorage.setItem('omakase_expires_at', newExpires);
            startSessionTimer(newExpires);
            alert("ë¡œê·¸ì¸ ì‹œê°„ì´ 1ì‹œê°„ìœ¼ë¡œ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
        function logout() { localStorage.removeItem('omakase_expires_at'); location.reload(); }
        function showDashboard() { document.getElementById('landing-page').classList.add('hidden'); document.getElementById('login-modal').classList.add('hidden'); document.getElementById('dashboard-page').classList.remove('hidden'); document.getElementById('dashboard-page').classList.add('flex'); window.scrollTo(0,0); }

        // --- Login ---
        function openLoginModal() { document.getElementById('login-modal').classList.remove('hidden'); document.getElementById('login_id').focus(); }
        function closeLoginModal() { document.getElementById('login-modal').classList.add('hidden'); }
        async function tryLogin() {
            const id = document.getElementById('login_id').value; const pw = document.getElementById('login_pw').value; const btn = document.getElementById('btn-login');
            if(!id || !pw) { alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin inline mr-2"></i> ë¡œê·¸ì¸ ì¤‘...`; btn.disabled = true; lucide.createIcons();
            try {
                const response = await fetch('api/login', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ user_id: id, password: pw }) });
                if(response.ok) { 
                    const expiresAt = Date.now() + SESSION_DURATION; localStorage.setItem('omakase_expires_at', expiresAt);
                    showDashboard(); startSessionTimer(expiresAt); fetchPublicSettings();
                } else { alert("âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨"); btn.innerHTML = "ë¡œê·¸ì¸ í•˜ê¸°"; btn.disabled = false; }
            } catch(e) { alert("ì„œë²„ ì—°ê²° ì‹¤íŒ¨"); btn.innerHTML = "ë¡œê·¸ì¸ í•˜ê¸°"; btn.disabled = false; }
        }

        // --- Admin & Stats ---
        async function openSettingsModal() {
            const pw = prompt("ê´€ë¦¬ì ì„¤ì •ì„ ì—´ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", "");
            if (pw !== "1234") { if (pw !== null) alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."); return; }
            document.getElementById('set_admin_pw').value = pw; 
            const modal = document.getElementById('settings-modal');
            
            try {
                // ê´€ë¦¬ì ì„¤ì •ì€ ì¸ì¦ëœ ìƒíƒœì—ì„œë§Œ í˜¸ì¶œ (Protected API)
                const res = await fetch('/api/admin/settings');
                if(res.ok) {
                    const data = await res.json();
                    document.getElementById('set_vcenter').value = data.vcenter_ip || "";
                    document.getElementById('set_esxi').value = data.esxi_ip || "";
                    document.getElementById('set_maint_mode').checked = data.maintenance_mode;
                    document.getElementById('set_max_vcpu').value = data.max_vcpu || 100;
                    document.getElementById('set_max_mem').value = data.max_memory || 256;
                    document.getElementById('set_notice').value = data.system_notice || "";
                }
                const statsRes = await fetch('/api/admin/stats');
                if(statsRes.ok) {
                    const stats = await statsRes.json();
                    document.getElementById('stat_total').innerText = stats.total_projects;
                    document.getElementById('stat_vcpu').innerText = stats.used_vcpu;
                    document.getElementById('stat_mem').innerText = stats.used_memory;
                    const maxVcpu = document.getElementById('set_max_vcpu').value || 100;
                    const maxMem = document.getElementById('set_max_mem').value || 256;
                    document.getElementById('stat_vcpu_max').innerText = `/ ${maxVcpu}`;
                    document.getElementById('stat_mem_max').innerText = `/ ${maxMem}`;
                    document.getElementById('bar_vcpu').style.width = Math.min((stats.used_vcpu / maxVcpu) * 100, 100) + "%";
                    document.getElementById('bar_mem').style.width = Math.min((stats.used_memory / maxMem) * 100, 100) + "%";
                }
                modal.classList.remove('hidden');
            } catch(e) { alert("í†µì‹  ì˜¤ë¥˜"); }
        }

        function closeSettingsModal() { document.getElementById('settings-modal').classList.add('hidden'); }
        async function saveSettings() {
            const btn = document.getElementById('btn-save-settings');
            const data = {
                vcenter_ip: document.getElementById('set_vcenter').value,
                esxi_ip: document.getElementById('set_esxi').value,
                maintenance_mode: document.getElementById('set_maint_mode').checked,
                max_vcpu: parseInt(document.getElementById('set_max_vcpu').value) || 100,
                max_memory: parseInt(document.getElementById('set_max_mem').value) || 256,
                system_notice: document.getElementById('set_notice').value,
                admin_password: document.getElementById('set_admin_pw').value
            };
            if(!data.admin_password) { alert("ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤."); return; }
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin"></i> Saving...`; btn.disabled = true; lucide.createIcons();
            try {
                const res = await fetch('/api/admin/settings', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
                if(res.ok) { alert("âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); closeSettingsModal(); fetchPublicSettings(); }
                else { const err = await res.json(); alert("âŒ ì €ì¥ ì‹¤íŒ¨: " + err.detail); }
            } catch(e) { alert("ì˜¤ë¥˜ ë°œìƒ"); }
            btn.innerHTML = `<i data-lucide="save"></i> Save Configuration`; btn.disabled = false; lucide.createIcons();
        }
        async function factoryReset() {
            const pw = prompt("ğŸš¨ ê²½ê³ : ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤!\nì§„í–‰í•˜ë ¤ë©´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", "");
            if(pw !== "1234") { if(pw!==null) alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"); return; }
            try {
                const res = await fetch('/api/admin/reset', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ user_id: "admin", password: pw }) });
                if(res.ok) { alert("ğŸ§¹ ì´ˆê¸°í™” ì™„ë£Œ!"); window.location.reload(); }
                else { alert("ì‹¤íŒ¨"); }
            } catch(e) { alert("ì˜¤ë¥˜"); }
        }

        // Logic
        function validateName() {
            const input = document.getElementById('svc_name'); const err = document.getElementById('name_err'); const btn = document.getElementById('btn-provision');
            if(/[^a-z0-9-]/.test(input.value)) { err.classList.remove('hidden'); input.classList.add('border-red-500','shake'); btn.disabled=true; setTimeout(()=>input.classList.remove('shake'),300); }
            else { err.classList.add('hidden'); input.classList.remove('border-red-500'); btn.disabled=false; }
        }
        
        function resetTemplateSelection() {
            document.querySelectorAll('[id^="tpl-"]').forEach(el => el.classList.remove('card-active'));
            document.getElementById('sum_type').innerText = "Custom Config";
        }

        function renderPackageGrid() {
            document.getElementById('package-grid').innerHTML = availableSoftware.map(sw => `<label class="cursor-pointer group select-none"><input type="checkbox" name="pkg" value="${sw.id}" class="pkg-checkbox hidden" onchange="updateSelectedPackages()"><div class="border border-slate-200 rounded-lg p-3 hover:border-blue-400 transition flex items-center justify-between bg-white h-full shadow-sm group-hover:shadow-md"><div class="flex flex-col"><span class="text-xs font-bold text-slate-700 group-hover:text-blue-700">${sw.name}</span><span class="text-[10px] text-slate-400 font-mono">${sw.cat}</span></div><i data-lucide="check-circle" class="icon-check w-4 h-4 text-blue-600 hidden"></i></div></label>`).join('');
            lucide.createIcons();
        }

        function updateSelectedPackages() {
            const checkboxes = document.querySelectorAll('input[name="pkg"]:checked');
            const listContainer = document.getElementById('selected-pkg-list');
            config.packages = [];
            
            if(checkboxes.length === 0) {
                listContainer.innerHTML = '<span class="text-xs text-slate-400">None</span>';
                return;
            }

            let html = '';
            checkboxes.forEach(chk => {
                const sw = availableSoftware.find(s => s.id === chk.value);
                if(sw) {
                    config.packages.push(sw.name);
                    html += `<span class="bg-blue-100 text-blue-700 border border-blue-200 px-2 py-1 rounded text-[10px] font-bold shadow-sm">${sw.name}</span>`;
                }
            });
            listContainer.innerHTML = html;
        }

        function resetSoftware() {
            document.querySelectorAll('input[name="pkg"]').forEach(el => el.checked = false);
            updateSelectedPackages();
        }

        function applyTemplate(type) {
            document.querySelectorAll('[id^="tpl-"]').forEach(el => el.classList.remove('card-active')); 
            document.getElementById(`tpl-${type}`).classList.add('card-active');

            const ts = document.getElementById('traffic_level'), 
                  hs = document.getElementById('ha_level'), 
                  st = document.getElementById('sum_type');

            if(type==='single') {
                config.template = 'single';
                ts.value='low'; 
                hs.value='single'; 
                st.innerText="Single Tier"; 
                selectPackages(['nginx', 'mysql', 'python']); 
            }
            else if(type==='3tier') {
                config.template = 'standard';
                ts.value='mid'; hs.value='ha'; 
                st.innerText="Standard 3-Tier"; 
                selectPackages(['haproxy', 'tomcat', 'postgres', 'python']); 
            }
            else {
                config.template = 'enterprise';
                ts.value='high'; 
                hs.value='ha'; 
                st.innerText="High Performance"; 
                selectPackages(['haproxy', 'nginx', 'redis', 'postgres', 'elasticsearch', 'kibana']); 
            }
            updateArchitecture();
        }

        function selectPackages(ids) {
            resetSoftware();
            ids.forEach(id => {
                const chk = document.querySelector(`input[value="${id}"]`);
                if(chk) chk.checked = true;
            });
            updateSelectedPackages();
        }

        function updateArchitecture() {
            config.traffic=document.getElementById('traffic_level').value; config.ha=document.getElementById('ha_level').value;
            let wc=config.traffic==='mid'?2:(config.traffic==='high'?4:1); if(config.ha==='ha'&&wc<2) wc=2; let dc=(config.ha==='ha'||config.traffic==='high')?2:1;
            let net = (config.traffic==='low'&&config.ha==='single') ? "âœ… Public Subnet (VLAN 10)\nâœ… Single Security Group" : (config.traffic==='high' ? "âœ… Multi-AZ Distribution\nâœ… High-Throughput VLAN 50, 60" : "âœ… Web-App-DB Separation\nâœ… VLAN 10 (Web), 20 (App), 30 (DB)\nâœ… Internal Firewall Rules Applied");
            document.getElementById('dynamic-network').innerText = net; config.network = net;
            
            // [UI Logic Update: ì´ë¯¸ì§€ì²˜ëŸ¼ ë…¹ìƒ‰ ì²´í¬ë°•ìŠ¤ ë¦¬ìŠ¤íŠ¸ë¡œ ìƒì„±]
            const dynamicNetwork = document.getElementById('dynamic-network');
            let items = [];
            if (config.traffic==='low' && config.ha==='single') {
                items = ["Public Subnet (VLAN 10)", "Single Security Group"];
            } else if (config.traffic==='high') {
                items = ["Multi-AZ Distribution", "High-Throughput VLAN 50, 60", "Direct Connect (DR)"];
            } else {
                items = ["Web-App-DB Separation", "VLAN 10 (Web), 20 (App), 30 (DB)", "Internal Firewall Rules Applied"];
            }
            // HTML ìƒì„±
            dynamicNetwork.innerHTML = items.map(item => 
                `<div class="flex items-center gap-2">
                    <div class="bg-green-600 text-white rounded-[2px] p-[1px]"><i data-lucide="check" class="w-3 h-3 stroke-[3]"></i></div>
                    <span class="text-xs font-mono text-slate-600">${item}</span>
                </div>`
            ).join('');
            config.network = items.join(", ");
            lucide.createIcons(); // ì•„ì´ì½˜ ìƒˆë¡œê³ ì¹¨

            let wh=''; for(let i=0;i<wc;i++) wh+=`<div class="bg-blue-600 p-3 rounded-lg shadow-lg border border-blue-400 flex flex-col items-center gap-1 w-24 node-enter"><i data-lucide="server" class="text-white w-6 h-6"></i><span class="text-[10px] font-bold text-white">WEB-0${i+1}</span></div>`; document.getElementById('layer-web').innerHTML=wh;
            let dh=`<div class="bg-slate-700 p-3 rounded-lg shadow-lg border border-slate-500 flex flex-col items-center gap-1 w-24 node-enter"><i data-lucide="database" class="text-yellow-400 w-6 h-6"></i><span class="text-[10px] font-bold text-white">DB-Master</span></div>`; if(dc>1) dh+=`<div class="bg-slate-700 p-3 rounded-lg shadow-lg border border-slate-500 flex flex-col items-center gap-1 w-24 opacity-80 node-enter"><i data-lucide="copy" class="text-slate-400 w-6 h-6"></i><span class="text-[10px] font-bold text-white">DB-Slave</span></div>`; document.getElementById('layer-db').innerHTML=dh;
            document.getElementById('layer-lb').classList.toggle('hidden',config.ha!=='ha'); document.getElementById('layer-dr').classList.toggle('hidden',config.traffic!=='high');
            document.getElementById('sum_vcpu').innerText=(wc*2+dc*4)+" vCore"; document.getElementById('sum_ha').innerText=config.ha==='ha'?"Active-Standby":"Single";
            let mh=''; if(config.ha==='ha') mh+=`<tr><td class="p-2">LB-VRRP-01</td><td class="p-2 text-blue-600">haproxy_lb</td></tr>`; for(let i=0;i<wc;i++) mh+=`<tr><td class="p-2">WEB-0${i+1}</td><td class="p-2 text-blue-600">nginx_php</td></tr>`; mh+=`<tr><td class="p-2">DB-Master</td><td class="p-2 text-blue-600">postgres_primary</td></tr>`; if(dc>1) mh+=`<tr><td class="p-2">DB-Slave</td><td class="p-2 text-blue-600">postgres_replica</td></tr>`; 
            document.getElementById('manifest-body').innerHTML=mh; 
        }

        async function startProvision() {
            const name=document.getElementById('svc_name').value; 
            const btn=document.getElementById('btn-provision'); 
            const org=btn.innerHTML;
            const userTag = "admin_user";
            if(!name || /[^a-z0-9-]/.test(name)) { 
                alert("ì„œë¹„ìŠ¤ ì´ë¦„ì„ í™•ì¸í•˜ì„¸ìš”."); 
                return; 
            }
            btn.innerHTML=`<i data-lucide="loader-2" class="animate-spin"></i> Processing...`; 
            btn.disabled=true; 
            lucide.createIcons();
            try {
                const res = await fetch('/api/provision', { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({ 
                        serviceName: name, 
                        config: config, 
                        userName: userTag, 
                        targetInfra: {} }) 
                });

                if(res.ok) { 
                    const data = await res.json(); 
                    console.log("ğŸ“¦ ë°±ì—”ë“œ ì‘ë‹µ ë°ì´í„°:", data); 
                    document.getElementById('summary-panel').classList.add('hidden'); 
                    document.getElementById('console-panel').classList.remove('hidden'); 
                    document.getElementById('console-panel').classList.add('flex'); 

                    if (data.project_id) {
                        console.log("ğŸš€ ì›¹ì†Œì¼“ ì—°ê²° ì‹œë„ ì¤‘... ID:", data.project_id);
                        startLogStreaming(data.project_id);
                    }
                    runStep(1);
                } else { 
                    const err = await res.json(); 
                    alert("âŒ ì‹¤íŒ¨: "+ (err.detail|| "ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬")); 
                    btn.innerHTML=org; 
                    btn.disabled=false; 
                }
            } catch(e) { 
                alert("ì—°ê²° ì‹¤íŒ¨"); 
                btn.innerHTML=org; 
                btn.disabled=false; 
            }
            lucide.createIcons();
        }

        function startLogStreaming(projectId) {
            const logConsole = document.getElementById('console-log-area'); // ë¡œê·¸ ì¶œë ¥ ì˜ì—­
            if (!logConsole) {
                console.error("âŒ 'console-log-area' ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            logConsole.innerHTML = ''; // ì´ì „ ë¡œê·¸ ì´ˆê¸°í™”

            const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';
            const wsUrl = `${protocol}://${window.location.host}/ws/logs/${projectId}`;

            console.log("ğŸ”— ì ‘ì† ì£¼ì†Œ:", wsUrl);
            const socket = new WebSocket(wsUrl);

            socket.onopen = () => console.log("âœ… ì›¹ì†Œì¼“ ì„œë²„ì™€ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.");

            socket.onmessage = function(event) {
                const msg = event.data;
                const logConsole = document.getElementById('console-log-area');

                // [ì œì–´ ì‹ í˜¸ 1] ì§„í–‰ ë‹¨ê³„(Step 1~4) ë™ê¸°í™”
                if (msg.startsWith("::STEP_")) {
                    const stepNum = msg.split("_")[1];
                    console.log(`ğŸ“ Step ${stepNum} í™œì„±í™” ì‹ í˜¸ ìˆ˜ì‹ `);
                    runStep(parseInt(stepNum)); // ê¸°ì¡´ì— ì •ì˜ëœ runStep í•¨ìˆ˜ í˜¸ì¶œ
                    return;
                }

                // [ì œì–´ ì‹ í˜¸ 2] ìµœì¢… ë°°í¬ ì™„ë£Œ ì²˜ë¦¬
                if (msg === "::DEPLOY_COMPLETE::") {
                    const oldBtn = document.getElementById('btn-finish');
                    if (oldBtn) oldBtn.style.display = 'none';

                    if (typeof runStep === 'function') runStep(5);

                    const successDiv = document.createElement('div');
                    successDiv.className = "mt-6 p-6 bg-emerald-950/40 border border-emerald-500/50 rounded-2xl text-emerald-400 shadow-2xl shadow-emerald-500/10 fade-in";
                    successDiv.innerHTML = `
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0 w-12 h-12 bg-emerald-500/20 rounded-full flex items-center justify-center border border-emerald-500/30">
                                <i data-lucide="check" class="w-7 h-7 text-emerald-400"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold mb-1 text-emerald-300">Infrastructure Ready!</h3>
                                <p class="text-sm text-emerald-400/80 mb-6 leading-relaxed">
                                    ëª¨ë“  ì¸í”„ë¼ ìì› êµ¬ì„± ë° ì†Œí”„íŠ¸ì›¨ì–´ ìŠ¤íƒ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                                    ì´ì œ ëŒ€ì‹œë³´ë“œì—ì„œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                                </p>
                                <button onclick="location.href='/'" 
                                        class="flex items-center gap-2 px-6 py-3 bg-emerald-500 hover:bg-emerald-400 text-emerald-950 font-bold rounded-xl transition-all transform hover:scale-105 active:scale-95 shadow-lg shadow-emerald-500/20">
                                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                                    Go to Main Console
                                </button>
                            </div>
                        </div>
                    `;
                    logConsole.appendChild(successDiv);
        
                    // Lucide ì•„ì´ì½˜ ë‹¤ì‹œ ë Œë”ë§
                    if (window.lucide) lucide.createIcons();
                    logConsole.scrollTop = logConsole.scrollHeight;
                    return;
                }

                // [ì¼ë°˜ ë¡œê·¸] ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ì¶œë ¥ ë¡œì§ - ì—¬ê¸°ì„œë§Œ ìš”ì†Œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                const newLogLine = document.createElement('div'); // ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ì´ë¦„ ì‚¬ìš©
                newLogLine.className = "text-slate-300 mb-1 border-l-2 border-slate-800 pl-3 font-mono text-[12px]";
                newLogLine.innerText = msg;
                logConsole.appendChild(newLogLine); // ìƒì„±í•œ ìš”ì†Œë¥¼ ì •í™•íˆ ì¶”ê°€

                // ìë™ ìŠ¤í¬ë¡¤ í•˜ë‹¨ ìœ ì§€
                logConsole.scrollTop = logConsole.scrollHeight;
            };

            socket.onerror = function(error) {
                console.error("âŒ ì›¹ì†Œì¼“ ì—°ê²° ì—ëŸ¬ ë°œìƒ:", error);
                const errLine = document.createElement('div');
                errLine.style.color = '#ff4d4d';
                errLine.innerText = "[System Error] ì›¹ì†Œì¼“ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Nginx ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.";
                logConsole.appendChild(errLine);
            };

            socket.onclose = function() {
            const status = document.createElement('div');
            status.style.color = '#4ade80'; // ì„±ê³µ ì‹œ ì´ˆë¡ìƒ‰ í†¤
            status.style.marginTop = '10px';
            status.innerText = "\n[System] ë°°í¬ í”„ë¡œì„¸ìŠ¤ê°€ ì¢…ë£Œë˜ì–´ ì—°ê²°ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.";
            logConsole.appendChild(status);
            };
        }
        function runStep(s){ 

            if (s === 3) {
                const step2 = document.getElementById('step-2');
                if (step2 && step2.classList.contains('opacity-50')) {
                    runStep(2); // 2ë²ˆ ê°•ì œ í™œì„±í™”
                }
            }
            
            const el = document.getElementById(`step-${s}`);
            const ic = document.getElementById(`step-${s}-icon`);
    
            if (!el || !ic) return; // ìš”ì†Œê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨

            // 1. í™œì„±í™” ìŠ¤íƒ€ì¼ ì ìš©
            el.classList.remove('opacity-50');
            ic.classList.remove('bg-slate-700');
            ic.classList.add('bg-emerald-600'); // íŒŒë€ìƒ‰(loading) ë‹¨ê³„ë¥¼ ê±´ë„ˆë›°ê³  ë°”ë¡œ ì™„ë£Œ ì²˜ë¦¬
            ic.innerHTML = `<i data-lucide="check" class="w-4 h-4 text-white"></i>`;
    
            // 2. ì•„ì´ì½˜ ë Œë”ë§
            lucide.createIcons();

            // 3. ë§ˆì§€ë§‰ 5ë‹¨ê³„ì¸ ê²½ìš° ìƒë‹¨ ë¬¸êµ¬ ë³€ê²½ ë° ë²„íŠ¼ ë…¸ì¶œ
            if (s === 5) {
                document.querySelector('#console-panel h3').innerHTML = `<span class="text-emerald-400">Deployed!</span>`;
                const btn = document.getElementById('btn-finish');
                if (btn) btn.classList.remove('hidden');
            }
        }
    </script>
</body>
</html>