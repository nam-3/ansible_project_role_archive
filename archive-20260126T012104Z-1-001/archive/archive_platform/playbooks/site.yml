---
# ========================================
# Archive Platform Deployment Playbook
# Traffic Flow: Gateway -> ALB -> Web -> DBLB -> DB
# ========================================
# 
# Usage Examples:
#   Deploy all:           ansible-playbook -i inventory/hosts.ini playbooks/site.yml
#   Deploy gateway only:  ansible-playbook -i inventory/hosts.ini playbooks/site.yml --tags gateway
#   Deploy web tier:      ansible-playbook -i inventory/hosts.ini playbooks/site.yml --tags alb,web
#   Deploy DB tier:       ansible-playbook -i inventory/hosts.ini playbooks/site.yml --tags db,dblb
#   Skip DB deployment:   ansible-playbook -i inventory/hosts.ini playbooks/site.yml --skip-tags db
# ========================================

# - name: 1. Configure Management Gateway
#   hosts: gateway
#   tags:
#     - gateway
#     - frontend
#     - all
#   roles:
#     - gateway

- name: 2. Deploy Application Load Balancer (Web LB)
  hosts: alb
  tags:
    - alb
    - web_tier
    - frontend
    - all
  roles:
    - alb

- name: 3. Deploy Database Cluster (Etcd + Patroni)
  hosts: db_cluster
  tags:
    - db
    - db_cluster
    - backend
    - all
  roles:
    - etcd_db
    - patroni

- name: 4. Deploy Database Load Balancer (DBLB)
  hosts: dblb
  tags:
    - dblb
    - db_tier
    - backend
    - all
  roles:
    - db_haproxy

- name: 5. Deploy Web Servers
  hosts: web
  tags:
    - web
    - web_tier
    - frontend
    - all
  roles:
    - web
