[Unit]
Description=Archive Platform Web API
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/opt/cmp_app
Environment="DB_HOST={{ dblb_vip }}"
Environment="DB_PORT=5432"
Environment="DB_USER=admin"
Environment="DB_PASS=Soldesk1."
Environment="DB_NAME=cmp_db"
Environment="MONITORING_HOST={{ hostvars[groups['monitoring'][0]]['ansible_host'] }}"
Environment="REDIS_HOST=127.0.0.1"
Environment="ENCRYPT_KEY=9CWy6jZBeL28HNs3j-hXRZJvTHGiJxaaftTtSCYdo6U="
Environment="SECRET_KEY=archive-platform-secret-key-2026"
ExecStart=/usr/local/bin/uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
Restart=always

[Install]
WantedBy=multi-user.target
